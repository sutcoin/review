<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>업체/후기 제출</title>
  <style>
    :root{--bg:#f3f7fb;--card:#fff;--accent:#0066ff;--muted:#7a8796}
    body{font-family: "Noto Sans KR", Arial, sans-serif; background:var(--bg); margin:0;padding:28px}
    .wrap{max-width:980px;margin:0 auto}
    .card{background:var(--card);border-radius:12px;padding:26px;box-shadow:0 8px 24px rgba(20,36,80,0.06)}
    h1{margin:0 0 8px;font-size:22px;color:#123}
    p.lead{margin:0 0 18px;color:var(--muted)}
    label{display:block;font-weight:700;margin:12px 0 6px}
    .row{display:flex;gap:12px}
    input[type=text], input[type=url], textarea, input[type=number]{
      width:100%;padding:12px;border-radius:10px;border:1px solid #e6eef9;background:#fbfeff;box-sizing:border-box;
      font-size:14px;color:#123;
    }
    textarea{min-height:120px;resize:vertical}
    .rightBox{border:1px dashed #e6eef9;padding:14px;border-radius:10px;background:#fbfeff}
    .small{font-size:13px;color:var(--muted)}
    .btn{background:var(--accent);color:#fff;padding:10px 16px;border-radius:10px;border:0;cursor:pointer}
    .mutedBtn{background:#fff;border:1px solid #e6eef9;color:#123;padding:10px 14px;border-radius:10px}
    .form-grid{display:grid;grid-template-columns:1fr 320px;gap:18px}
    .full{grid-column:1/-1}
    .note{margin-top:18px;color:var(--muted);font-size:13px}
    @media(max-width:880px){ .form-grid{grid-template-columns:1fr} .rightBox{order:-1} }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>업체 정보 / 후기 제출</h1>
      <p class="lead">업체정보 또는 후기를 입력하고 이미지(선택)를 함께 업로드 해주세요. (이미지 최대 10장)</p>

      <!-- FORM: action 반드시 배포된 Apps Script exec URL로 교체 -->
      <form id="mainForm" action="FORM_ACTION_URL" method="post" enctype="multipart/form-data" target="submitFrame">
        <div class="form-grid">
          <div>
            <label>닉네임</label>
            <input name="nickname" type="text" placeholder="예: 홍길동" />

            <label>코드</label>
            <input name="code" type="text" placeholder="예: ABC123" />

            <label>소속</label>
            <input name="affiliation" type="text" placeholder="예: ○○협회" />

            <label>이용한 업체 <span class="small" style="color:#c33">*</span></label>
            <input name="usedStore" type="text" placeholder="예: ○○카페" required />

            <label>주소</label>
            <input name="address" type="text" placeholder="예: 대전광역시 ..." />

            <div class="row" style="margin-top:6px">
              <div style="flex:1">
                <label>전화번호</label>
                <input name="phone" type="text" placeholder="010-1234-5678" />
              </div>
              <div style="width:160px">
                <label>SUT 할인율 (%)</label>
                <input name="discount" type="number" min="0" max="100" placeholder="예: 10" />
              </div>
            </div>

            <label>네이버지도 링크</label>
            <input name="mapUrl" type="url" placeholder="https://map.naver.com/..." />

            <label>태그</label>
            <input name="tags" type="text" placeholder="#카페 #디저트" />

            <label class="full">업체 소개 / 후기 (200자 이내)</label>
            <textarea name="description" maxlength="200" placeholder="가게를 소개하거나 후기를 적어주세요. (200자 이내)"></textarea>

            <div style="margin-top:14px">
              <button type="submit" class="btn">제출하기</button>
              <button type="button" class="mutedBtn" onclick="document.getElementById('mainForm').reset();">양식 초기화</button>
            </div>

            <p class="note">제출된 정보는 블로그 게시용으로 사용됩니다. 개인정보는 안전하게 처리됩니다.</p>
          </div>

          <div>
            <div class="rightBox">
              <h3 style="margin:0 0 8px">업체홍보 사진 (최대 10장)</h3>
              <p class="small">권장: 가로/세로 1200px 이하, 파일당 1~2MB 이하</p>
              <input id="files" name="photos" type="file" accept="image/*" multiple style="margin-top:10px;width:100%" />
              <p class="small" style="margin-top:10px;color:#c33">주의: 파일 업로드 실패 시 앱스크립트 실행 로그(Executions)를 확인하세요.</p>
            </div>
          </div>
        </div>
      </form>

      <iframe name="submitFrame" id="submitFrame" style="display:none;"></iframe>
    </div>
  </div>

  <script>
    // 여기에 Apps Script exec URL을 넣어주세요 (배포 후 얻은 /exec URL)
    const FORM_ACTION_URL = "https://script.google.com/macros/s/AKfycbzIjANxI0GSlUdggMn7EOx2uL_BzCOKBLQsXbzIiiZNRmowOmvS0zc-efhkyDn3eCWFaw/exec";
    document.getElementById('mainForm').action = FORM_ACTION_URL;

    // iframe 으로 제출된 후 서버가 반환하는 HTML에서 부모창으로 postMessage가 오면 처리
    window.addEventListener("message", function(ev){
      try {
        var d = ev.data;
        if (typeof d === "string") {
          // 서버가 문자열을 보냈을 때
          alert(d);
        } else if (d && d.ok) {
          alert("제출 완료되었습니다.\n저장 폴더: " + (d.folderUrl || ""));
          document.getElementById('mainForm').reset();
        } else {
          alert("서버 응답 실패: " + (d && d.message ? d.message : JSON.stringify(d)));
        }
      } catch(err) {
        console.error("message handle err", err);
      }
    }, false);
  </script>
</body>
</html>
